- name: "LOW | V-1075 | AUDIT | The shutdown option will not be available from the logon dialog box."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System /v ShutdownWithoutLogon
  register: shutdown_button_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in shutdown_button_audit.stderr and shutdown_button_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1075

- name: "LOW | V-1075 | PATCH | The shutdown option will not be available from the logon dialog box."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System'
      value: ShutdownWithoutLogon
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1075

- name: "LOW | V-1090 | AUDIT | Caching of logon credentials must be limited."
  win_command: reg query \"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v CachedLogonsCount
  register: cached_logons_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in cached_logons_audit.stderr and cached_logons_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1090

- name: "LOW | V-1090 | PATCH | Caching of logon credentials must be limited."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: CachedLogonsCount
      data: 0
  tags:
      - cat3
      - low
      - patch
      - V-1090

- name: "LOW | V-1112 | AUDIT | Outdated or unused accounts must be removed from the system or disabled."
  script: v1112.ps1
  register: outdated_accounts_audit
  check_mode: no
  changed_when: no
  tags:
      - cat3
      - low
      - audit
      - V-1112

- name: "LOW | V-1151 | AUDIT | The print driver installation privilege will be restricted to administrators."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers\" /v AddPrinterDrivers
  register: add_printer_driver_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in add_printer_driver_audit.stderr and add_printer_driver_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1151

- name: "LOW | V-1151 | PATCH | The print driver installation privilege will be restricted to administrators."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers'
      value: AddPrinterDrivers
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1151

- name: "LOW | V-1158 | AUDIT | The Recovery Console SET command must be disabled."
  win_command: reg query \"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole\" /v SetCommand
  register: set_command_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in set_command_audit.stderr and set_command_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1158

- name: "LOW | V-1158 | PATCH | The Recovery Console SET command must be disabled."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole'
      value: SetCommand
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1158

- name: "LOW | V-1165 | AUDIT | The computer account password will not be prevented from being reset."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v DisablePasswordChange
  register: disable_password_change_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_password_change_audit.stderr and disable_password_change_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1165

- name: "LOW | V-1165 | PATCH | The computer account password will not be prevented from being reset."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: DisablePasswordChange
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1165

- name: "LOW | V-1172 | AUDIT | Users will be warned in advance that their passwords will expire."
  win_command: reg query \"HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v PasswordExpiryWarning
  register: password_expiry_warning_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in password_expiry_warning_audit.stderr and password_expiry_warning_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1172

- name: "LOW | V-1172 | PATCH | Users will be warned in advance that their passwords will expire."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: PasswordExpiryWarning
      data: 7
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1172

- name: "LOW | V-1173 | AUDIT | The default permissions of Global system objects will be increased."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Session Manager\" /v ProtectionMode
  register: protection_mode_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in protection_mode_audit.stderr and protection_mode_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1173

- name: "LOW | V-1173 | PATCH | The default permissions of Global system objects will be increased."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: ProtectionMode
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1173

- name: "LOW | V-1174 | AUDIT | The amount of idle time required before suspending a session must be properly set."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters /v autodisconnect
  register: auto_disconnect_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in auto_disconnect_audit.stderr and auto_disconnect_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-1174

- name: "LOW | V-1174 | PATCH | The amount of idle time required before suspending a session must be properly set."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters'
      value: autodisconnect
      data: 0x0000000f
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-1174

- name: "LOW | V-3373 | AUDIT | The maximum age for machine account passwords will be set to requirements."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Netlogon\Parameters /v MaximumPasswordAge
  register: max_password_age_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in max_password_age_audit.stderr and max_password_age_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3373

- name: "LOW | V-3373 | PATCH | The maximum age for machine account passwords will be set to requirements."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters'
      value: MaximumPasswordAge
      data: 30
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-3373

- name: "LOW | V-3472 | AUDIT | If the time service is configured, it will use an authorized time server."
  win_command: reg query HKLM\Software\Policies\Microsoft\W32time\Parameters /v Type
  register: time_type_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in time_type_audit.stderr and time_type_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3472

- name: "LOW | V-3472 | AUDIT | If the time service is configured, it will use an authorized time server."
  win_command: reg query HKLM\Software\Policies\Microsoft\W32time\Parameters /v NTPServer
  register: NTP_server_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in NTP_server_audit.stderr and NTP_server_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-3472

- name: "LOW | V-4110 | AUDIT | The system will be configured to prevent IP source routing."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v DisableIPSourceRouting
  register: disable_ip_routing_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_ip_routing_audit.stderr and disable_ip_routing_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4110

- name: "LOW | V-4110 | PATCH | The system will be configured to prevent IP source routing."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: DisableIPSourceRouting
      data: 2
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4110

- name: "LOW | V-4112 | AUDIT | The system will be configured to disable the Internet Router Discover Protocol (IRDP)."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v PerformRouterDiscovery
  register: disable_IRDP_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in disable_IRDP_audit.stderr and disable_IRDP_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4112

- name: "LOW | V-4112 | PATCH | The system will be configured to disable the Internet Router Discover Protocol (IRDP)."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: PerformRouterDiscovery
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4112

- name: "LOW | V-4113 | AUDIT | The system will be configured to limit how often keep-alive packets are sent."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v KeepAliveTime
  register: keep_alive_time_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in keep_alive_time_audit.stderr and keep_alive_time_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4113

- name: "LOW | V-4113 | PATCH | The system will be configured to limit how often keep-alive packets are sent."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: KeepAliveTime
      data: 300000
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4113

- name: "LOW | V-4116 | AUDIT | The system must be configured to ignore NetBIOS name release requests except from WINS servers."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\Netbt\Parameters /v NoNameReleaseOnDemand
  register: name_release_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in name_release_audit.stderr and name_release_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4116

- name: "LOW | V-4116 | PATCH | The system must be configured to ignore NetBIOS name release requests except from WINS servers."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\Netbt\Parameters'
      value: NoNameReleaseOnDemand
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4116

- name: "LOW | V-4438 | AUDIT | The system must limit how many times unacknowledged TCP data is retransmitted."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters /v TcpMaxDataRetransmissions
  register: max_TCP_retransmit_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in max_TCP_retransmit_audit.stderr and max_TCP_retransmit_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4438

- name: "LOW | V-4438 | PATCH | The system must limit how many times unacknowledged TCP data is retransmitted."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters'
      value: TcpMaxDataRetransmissions
      data: 3
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-4438

- name: "LOW | V-4442 | AUDIT | The system will be configured to have password protection take effect within a limited time frame when the screen saver becomes active."
  win_command: reg query \"HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\" /v ScreenSaverGracePeriod
  register: screen_saver_password_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in screen_saver_password_audit.stderr and screen_saver_password_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4442

- name: "LOW | V-4442 | PATCH | The system will be configured to have password protection take effect within a limited time frame when the screen saver becomes active."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
      value: ScreenSaverGracePeriod
      data: 0
      datatype: string
  tags:
      - cat3
      - low
      - patch
      - V-4442

- name: "LOW | V-4445 | AUDIT | Optional Subsystems will not be permitted to operate on the system."
  win_command: reg query \"HKLM\System\CurrentControlSet\Control\Session Manager\Subsystems\" /v Optional
  register: optional_subsystem_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in optional_subsystem_audit.stderr and optional_subsystem_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-4445

- name: "LOW | V-4445 | PATCH | Optional Subsystems will not be permitted to operate on the system."
  win_command: reg add \"HKLM\System\CurrentControlSet\Control\Session Manager\Subsystems\" /v Optional /t REG_MULTI_SZ /f
  tags:
      - cat3
      - low
      - patch
      - V-4445

- name: "LOW | V-11806 | AUDIT | The system will be configured to prevent the display of the last user name on the logon screen."
  win_command: reg query \"HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\" /v DontDisplayLastUserName
  register: last_name_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in last_name_audit.stderr and last_name_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-11806

- name: "LOW | V-11806 | PATCH | The system will be configured to prevent the display of the last user name on the logon screen."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System'
      value: DontDisplayLastUserName
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-11806

- name: "LOW | V-15672 | AUDIT | Event Viewer Events.asp links will be turned off."
  win_command: reg query HKLM\Software\Policies\Microsoft\EventViewer /v MicrosoftEventVwrDisableLinks
  register: event_viewer_links_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in event_viewer_links_audit.stderr and event_viewer_links_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15672

- name: "LOW | V-15672 | PATCH | Event Viewer Events.asp links will be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\EventViewer'
      value: MicrosoftEventVwrDisableLinks
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15672

- name: "LOW | V-15680 | AUDIT | The classic logon screen must be required for user logons."
  win_command: reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LogonType
  register: classic_logon_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in classic_logon_audit.stderr and classic_logon_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15680

- name: "LOW | V-15680 | PATCH | The classic logon screen must be required for user logons."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System'
      value: LogonType
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15680

- name: "LOW | V-15686 | AUDIT | Non-administrators will be prevented from applying vendor signed updates."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\Installer /v DisableLUAPatching
  register: diable_user_patching_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in diable_user_patching_audit.stderr and diable_user_patching_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15686

- name: "LOW | V-15686 | PATCH | Non-administrators will be prevented from applying vendor signed updates."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\Installer'
      value: DisableLUAPatching
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15686

- name: "LOW | V-15687 | AUDIT | Users will not be presented with Privacy and Installation options on first use of Windows Media Player."
  win_command: reg query HKLM\Software\Policies\Microsoft\WindowsMediaPlayer /v GroupPrivacyAcceptance
  register: group_privacy_acceptance_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in group_privacy_acceptance_audit.stderr and group_privacy_acceptance_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15687

- name: "LOW | V-15687 | PATCH | Users will not be presented with Privacy and Installation options on first use of Windows Media Player."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\WindowsMediaPlayer'
      value: GroupPrivacyAcceptance
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15687

- name: "LOW | V-15701 | AUDIT | A system restore point will be created when a new device driver is installed."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DeviceInstall\Settings /v DisableSystemRestore
  register: restore_point_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in restore_point_audit.stderr and restore_point_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15701

- name: "LOW | V-15701 | PATCH | A system restore point will be created when a new device driver is installed."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DeviceInstall\Settings'
      value: DisableSystemRestore
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15701

- name: "LOW | V-15702 | AUDIT | An Error Report will not be sent when a generic device driver is installed."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DeviceInstall\Settings /v DisableSendGenericDriverNotFoundToWER
  register: no_error_report_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in no_error_report_audit.stderr and no_error_report_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15702

- name: "LOW | V-15702 | PATCH | An Error Report will not be sent when a generic device driver is installed."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DeviceInstall\Settings'
      value: DisableSendGenericDriverNotFoundToWER
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15702

- name: "LOW | V-15703 | AUDIT | Users will not be prompted to search Windows Update for device drivers."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DriverSearching /v DontPromptForWindowsUpdate
  register: no_prompt_windows_update_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in no_prompt_windows_update_audit.stderr and no_prompt_windows_update_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15703

- name: "LOW | V-15703 | PATCH | Users will not be prompted to search Windows Update for device drivers."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DriverSearching'
      value: DontPromptForWindowsUpdate
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15703

- name: "LOW | V-15704 | AUDIT | Errors in handwriting recognition on Tablet PCs will not be reported to Microsoft."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\HandwritingErrorReports /v PreventHandwritingErrorReports
  register: no_handwriting_error_reports_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in no_handwriting_error_reports_audit.stderr and no_handwriting_error_reports_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15704

- name: "LOW | V-15704 | PATCH | Errors in handwriting recognition on Tablet PCs will not be reported to Microsoft."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\HandwritingErrorReports'
      value: PreventHandwritingErrorReports
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15704

- name: "LOW | V-15707 | PATCH | Remote Assistance log files will be generated."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Terminal Services'
      value: LoggingEnabled
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15707

- name: "LOW | V-15718 | AUDIT | Windows Explorer heap termination on corruption will be disabled."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\Explorer /v NoHeapTerminationOnCorruption
  register: heap_termination_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in heap_termination_audit.stderr and heap_termination_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15718

- name: "LOW | V-15718 | PATCH | Windows Explorer heap termination on corruption will be disabled."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\Explorer'
      value: NoHeapTerminationOnCorruption
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15718

- name: "LOW | V-15719 | AUDIT | Users must be notified if the logon server was inaccessible and cached credentials were used."
  win_command: reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v ReportControllerMissing
  register: failed_cached_logon_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in failed_cached_logon_audit.stderr and failed_cached_logon_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-15719

- name: "LOW | V-15719 | PATCH | Users must be notified if the logon server was inaccessible and cached credentials were used."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System'
      value: ReportControllerMissing
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-15719

- name: "LOW | V-16005 | AUDIT | The system will be configured to remove the Disconnect option from the Shut Down Windows dialog box on the Remote Desktop Client. (Remote Desktop Services Role)"
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer /v NoDisconnect
  register: no_disconnect_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in no_disconnect_audit.stderr and no_disconnect_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-16005

- name: "LOW | V-16005 | PATCH | The system will be configured to remove the Disconnect option from the Shut Down Windows dialog box on the Remote Desktop Client. (Remote Desktop Services Role)"
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer'
      value: NoDisconnect
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-16005

- name: "LOW | V-21955 | AUDIT | IPv6 source routing will be configured to highest protection."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters /v DisableIPSourceRouting
  register: IPv6_source_routing_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in IPv6_source_routing_audit.stderr and IPv6_source_routing_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21955

- name: "LOW | V-21955 | PATCH | IPv6 source routing will be configured to highest protection."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters'
      value: DisableIPSourceRouting
      data: 2
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21955

- name: "LOW | V-21956 | AUDIT | IPv6 TCP data retransmissions must be configured to prevent resources from becoming exhausted."
  win_command: reg query HKLM\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters /v TcpMaxDataRetransmissions
  register: IPv6_retransmit_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in IPv6_retransmit_audit.stderr and IPv6_retransmit_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21956

- name: "LOW | V-21956 | PATCH | IPv6 TCP data retransmissions must be configured to prevent resources from becoming exhausted."
  win_regedit:
      key: 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters'
      value: TcpMaxDataRetransmissions
      data: 3
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21956

- name: "LOW | V-21960 | AUDIT | Domain users will be required to elevate when setting a network's location."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows\Network Connections\" /v NC_StdDomainUserSetLocation
  register: elevate_setting_network_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in elevate_setting_network_audit.stderr and elevate_setting_network_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21960

- name: "LOW | V-21960 | PATCH | Domain users will be required to elevate when setting a network's location."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\Network Connections'
      value: NC_StdDomainUserSetLocation
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21960

- name: "LOW | V-21961 | AUDIT | All Direct Access traffic will be routed through the internal network."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\TCPIP\v6Transition /v Force_Tunneling
  register: force_tunneling_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in force_tunneling_audit.stderr and force_tunneling_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21961

- name: "LOW | V-21963 | AUDIT | Windows Update will be prevented from searching for point and print drivers."
  win_command: reg query \"HKLM\Software\Policies\Microsoft\Windows NT\Printers\" /v DoNotInstallCompatibleDriverFromWindowsUpdate
  register: windows_update_search_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in windows_update_search_audit.stderr and windows_update_search_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21963

- name: "LOW | V-21963 | PATCH | Windows Update will be prevented from searching for point and print drivers."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers'
      value: DoNotInstallCompatibleDriverFromWindowsUpdate
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21963

- name: "LOW | V-21964 | AUDIT | Device metadata retrieval from the Internet must be prevented."
  win_command: reg query \"HKLM\SOFTWARE\Policies\Microsoft\Windows\Device Metadata\" /v PreventDeviceMetadataFromNetwork
  register: device_metadata_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in device_metadata_audit.stderr and device_metadata_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21964

- name: "LOW | V-21964 | PATCH | Device metadata retrieval from the Internet must be prevented."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Device Metadata'
      value: PreventDeviceMetadataFromNetwork
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21964

- name: "LOW | V-21965 | AUDIT | Device driver searches using Windows Update will be prevented."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DriverSearching /v SearchOrderConfig
  register: windows_update_device_driver_search_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in windows_update_device_driver_search_audit.stderr and windows_update_device_driver_search_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21965

- name: "LOW | V-21965 | PATCH | Device driver searches using Windows Update will be prevented."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DriverSearching'
      value: SearchOrderConfig
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21965

- name: "LOW | V-21967 | AUDIT | Microsoft Support Diagnostic Tool (MSDT) interactive communication with Microsoft will be prevented."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy /v DisableQueryRemoteServer
  register: MSDT_communication_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in MSDT_communication_audit.stderr and MSDT_communication_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21967

- name: "LOW | V-21967 | PATCH | Microsoft Support Diagnostic Tool (MSDT) interactive communication with Microsoft will be prevented."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy'
      value: DisableQueryRemoteServer
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21967

- name: "LOW | V-21969 | AUDIT | Access to Windows Online Troubleshooting Service (WOTS) will be prevented."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy /v EnableQueryRemoteServer
  register: WOTS_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in WOTS_audit.stderr and WOTS_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21969

- name: "LOW | V-21969 | PATCH | Access to Windows Online Troubleshooting Service (WOTS) will be prevented."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy'
      value: EnableQueryRemoteServer
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21969

- name: "LOW | V-21970 | AUDIT | Responsiveness events will be prevented from being aggregated and sent to Microsoft."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\WDI\{9c5a40da-b965-4fc3-8781-88dd50a6299d} /v ScenarioExecutionEnabled
  register: WOTS_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in WOTS_audit.stderr and WOTS_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21970

- name: "LOW | V-21970 | PATCH | Responsiveness events will be prevented from being aggregated and sent to Microsoft."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\WDI\{9c5a40da-b965-4fc3-8781-88dd50a6299d}'
      value: ScenarioExecutionEnabled
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21970

- name: "LOW | V-21971 | AUDIT | The Application Compatibility Program Inventory will be prevented from collecting data and sending the information to Microsoft."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\AppCompat /v DisableInventory
  register: ACPI_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in ACPI_audit.stderr and ACPI_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-21971

- name: "LOW | V-21971 | PATCH | The Application Compatibility Program Inventory will be prevented from collecting data and sending the information to Microsoft."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\AppCompat'
      value: DisableInventory
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-21971

- name: "LOW | V-26475 | AUDIT | Unauthorized accounts must not have the Bypass traverse checking user right."
  debug: var=secedit_rules.Privilege_Rights.SeChangeNotifyPrivilege
  check_mode: no
  changed_when: no
  tags:
      - cat3
      - low
      - audit
      - V-26475

# Well-known security identifiers in Windows operating systems
# https://support.microsoft.com/en-us/kb/243330
- name: "LOW | V-26475 | PATCH | Unauthorized accounts must not have the Bypass traverse checking user right."
  win_secedit:
      category: 'Privilege Rights'
      key: SeChangeNotifyPrivilege
      value: '*S-1-5-11,*S-1-5-19,*S-1-5-20,*S-1-5-32-544' #Authenticated Users, Local Service, Network Service, Administrators
  register: secedit
  failed_when: "secedit.failed is defined and 'This host is joined to a Domain Controller' not in secedit.msg"
  tags:
      - cat3
      - low
      - patch
      - V-26475

- name: "LOW | V-26477 | AUDIT | Unauthorized accounts must not have the Change the time zone user right."
  debug: var=secedit_rules.Privilege_Rights.SeTimeZonePrivilege
  check_mode: no
  changed_when: no
  tags:
      - cat3
      - low
      - audit
      - V-26477

- name: "LOW | V-26477 | PATCH | Unauthorized accounts must not have the Change the time zone user right."
  win_secedit:
      category: 'Privilege Rights'
      key: SeTimeZonePrivilege
      value: '*S-1-5-19,*S-1-5-32-544' #Local Service, Administrators
  register: secedit
  failed_when: "secedit.failed is defined and 'This host is joined to a Domain Controller' not in secedit.msg"
  tags:
      - cat3
      - low
      - patch
      - V-26477

- name: "LOW | V-28504 | AUDIT | Windows will be prevented from sending an error report when a device driver requests additional software during installation."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DeviceInstall\Settings /v DisableSendRequestAdditionalSoftwareToWER
  register: send_error_report_audit
  check_mode: no
  changed_when: no
  failed_when: "send_error_report_audit.stderr and reg_not_found not in send_error_report_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-28504

- name: "LOW | V-28504 | PATCH | Windows will be prevented from sending an error report when a device driver requests additional software during installation."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DeviceInstall\Settings'
      value: DisableSendRequestAdditionalSoftwareToWER
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-28504

- name: "LOW | V-36673 | AUDIT | IP stateless autoconfiguration limits state must be enabled."
  win_command: reg query HKLM\System\CurrentControlSet\Services\Tcpip\Parameters\ /v EnableIPAutoConfigurationLimits
  register: ip_config_limits_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in ip_config_limits_audit.stderr and ip_config_limits_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36673

- name: "LOW | V-36673 | PATCH | IP stateless autoconfiguration limits state must be enabled."
  win_regedit:
      key: 'HKLM:\System\CurrentControlSet\Services\Tcpip\Parameters\'
      value: EnableIPAutoConfigurationLimits
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36673

- name: "LOW | V-36677 | AUDIT | Optional component installation and component repair must be prevented from using Windows Update."
  win_command: reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Servicing\ /v UseWindowsUpdate
  register: optional_install_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in optional_install_audit.stderr and optional_install_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36677

- name: "LOW | V-36677 | PATCH | Optional component installation and component repair must be prevented from using Windows Update."
  win_regedit:
      key: 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\Servicing\'
      value: UseWindowsUpdate
      data: 2
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36677

- name: "LOW | V-36678 | AUDIT | Device driver updates must only search managed servers, not Windows Update."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\DriverSearching\ /v DriverServerSelection
  register: search_managed_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in search_managed_audit.stderr and search_managed_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36678

- name: "LOW | V-36678 | PATCH | Device driver updates must only search managed servers, not Windows Update."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\DriverSearching\'
      value: DriverServerSelection
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36678

- name: "LOW | V-36696 | AUDIT | The detection of compatibility issues for applications and drivers must be turned off."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\AppCompat\ /v DisablePcaUI
  register: detection_compatibility_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in detection_compatibility_audit.stderr and detection_compatibility_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36696

- name: "LOW | V-36696 | PATCH | The detection of compatibility issues for applications and drivers must be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\AppCompat\'
      value: DisablePcaUI
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36696

- name: "LOW | V-36697 | AUDIT | Trusted app installation must be enabled to allow for signed enterprise line of business apps."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\Appx\ /v AllowAllTrustedApps
  register: trusted_app_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in trusted_app_audit.stderr and trusted_app_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36697

- name: "LOW | V-36697 | PATCH | Trusted app installation must be enabled to allow for signed enterprise line of business apps."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\Appx\'
      value: AllowAllTrustedApps
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36697

- name: "LOW | V-36707 | AUDIT | The Windows SmartScreen must be turned off."
  win_command: reg query HKLM\Software\Policies\Microsoft\Windows\System\ /v EnableSmartScreen
  register: smartscreen_off_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in smartscreen_off_audit.stderr and smartscreen_off_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36707

- name: "LOW | V-36707 | PATCH | The Windows SmartScreen must be turned off."
  win_regedit:
      key: 'HKLM:\Software\Policies\Microsoft\Windows\System\'
      value: EnableSmartScreen
      data: 0
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36707

- name: "LOW | V-36710 | AUDIT | Automatic download of updates from the Windows Store must be turned off."
  win_command: reg query HKLM\SOFTWARE\Policies\Microsoft\WindowsStore\ /v AutoDownload
  register: auto_download_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in auto_download_audit.stderr and auto_download_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36710

- name: "LOW | V-36710 | PATCH | Automatic download of updates from the Windows Store must be turned off."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsStore\'
      value: AutoDownload
      data: 0x00000002
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36710

- name: "LOW | V-36774 | AUDIT | A screen saver must be defined."
  win_command: reg query \"HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop\" /v SCRNSAVE.EXE
  register: screen_saver_disabled_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in screen_saver_disabled_audit.stderr and screen_saver_disabled_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36774

- name: "LOW | V-36774 | PATCH | A screen saver must be defined."
  win_regedit:
      key: 'HKCU:\Software\Policies\Microsoft\Windows\Control Panel\Desktop\'
      value: SCRNSAVE.EXE
      data: scrnsave.scr
      datatype: string
  tags:
      - cat3
      - low
      - patch
      - V-36774

- name: "LOW | V-36775 | AUDIT | Changing the screen saver must be prevented."
  win_command: reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\System\ /v NoDispScrSavPage
  register: screen_change_prevent_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in screen_change_prevent_audit.stderr and screen_change_prevent_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36775

- name: "LOW | V-36775 | PATCH | Changing the screen saver must be prevented."
  win_regedit:
      key: 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\System\'
      value: NoDispScrSavPage
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36775

- name: "LOW | V-36776 | AUDIT | Notifications from Windows Push Network Service must be turned off."
  win_command: reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications\ /v NoCloudApplicationNotification
  register: windows_push_notify_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in windows_push_notify_audit.stderr and windows_push_notify_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36776

- name: "LOW | V-36776 | PATCH | Notifications from Windows Push Network Service must be turned off."
  win_regedit:
      key: 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\System\'
      value: NoCloudApplicationNotification
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36776

- name: "LOW | V-36777 | AUDIT | Toast notifications to the lock screen must be turned off."
  win_command: reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications\ /v NoToastApplicationNotificationOnLockScreen
  register: toast_notifications_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in toast_notifications_audit.stderr and toast_notifications_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-36777

- name: "LOW | V-36777 | PATCH | Toast notifications to the lock screen must be turned off."
  win_regedit:
      key: 'HKCU:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications\'
      value: NoToastApplicationNotificationOnLockScreen
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-36776

- name: "LOW | V-43241 | AUDIT | The setting to allow Microsoft accounts to be optional for modern style apps must be enabled (Windows 2012 R2)."
  win_command: reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v MSAOptional
  register: modern_style_audit
  check_mode: no
  changed_when: no
  failed_when: "reg_not_found not in modern_style_audit.stderr and modern_style_audit.stderr"
  tags:
      - cat3
      - low
      - audit
      - V-43241

- name: "LOW | V-43241 | PATCH | The setting to allow Microsoft accounts to be optional for modern style apps must be enabled (Windows 2012 R2)."
  win_regedit:
      key: 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System'
      value: MSAOptional
      data: 1
      datatype: dword
  tags:
      - cat3
      - low
      - patch
      - V-43241
